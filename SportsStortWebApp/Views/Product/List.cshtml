@using SportsStore.Domain.Entities
@model IEnumerable<Product>
@{
	ViewData["Title"] = "Danh sách sản phẩm";
	int totalPages = 0;
	int itemsPerPageLocal = ViewBag.ItemsPerPage ?? 3;
	try {
		totalPages = (int)Math.Ceiling((decimal)(ViewBag.TotalItems ?? 0) / itemsPerPageLocal);
	} catch { }
}

<h1 class="text-center">Danh sách sản phẩm - @ViewBag.CurrentCategory</h1>

@* TempData flash message is rendered in the shared layout; avoid duplicating it here *@

@if (Model != null && Model.Any())
{
	<table class="table table-bordered table-striped">
		<thead>
			<tr>
				<th>ID</th>
				<th>Tên</th>
				<th>Mô tả</th>
				<th>Giá</th>
				<th>Danh mục</th>
				<th>Hành động</th>
			</tr>
		</thead>
		<tbody>
		@foreach (var p in Model)
		{
			<tr>
				<td>@p.ProductID</td>
				<td>@p.Name</td>
				<td>@p.Description</td>
				<td>$ @p.Price.ToString("#,##0.00")</td>
				<td>@p.Category</td>
				<td>
					<a asp-controller="Product" asp-action="Edit" asp-route-id="@p.ProductID" class="btn btn-warning btn-sm">Sửa</a>
					<form asp-controller="Product" asp-action="Delete" method="post" style="display:inline-block;margin-left:6px;" onsubmit="return confirm('Bạn có chắc muốn xóa sản phẩm này?');">
						@Html.AntiForgeryToken()
						<input type="hidden" name="productId" value="@p.ProductID" />
						<button type="submit" class="btn btn-danger btn-sm">Xóa</button>
					</form>

					<form asp-controller="Cart" asp-action="AddToCart" method="post" style="display:inline-block;margin-left:6px;">
						<input type="hidden" name="productId" value="@p.ProductID" />
						<input type="hidden" name="returnUrl" value="@Url.Action("List", "Product")" />
						<button type="submit" class="btn btn-success btn-sm">Thêm vào giỏ</button>
					</form>
				</td>
			</tr>
		}
		</tbody>
	</table>

	<div class="my-3">
		<nav>
			<ul class="pagination">
				@for (int i = 1; i <= Math.Max(1, totalPages); i++)
				{
					<li class="page-item @(i == (ViewBag.CurrentPage ?? 1) ? "active" : "")">
						<a class="page-link" asp-action="List" asp-route-productPage="@i" asp-route-itemsPerPage="@itemsPerPageLocal" asp-route-category="@(ViewBag.CurrentCategory == "Tất cả sản phẩm" ? "" : ViewBag.CurrentCategory)">@i</a>
					</li>
				}
			</ul>
		</nav>
	</div>
}
else
{
	<p>Không có sản phẩm nào để hiển thị.</p>
}

<div class="mt-4">
	<h4>Lọc theo danh mục:</h4>
	<div class="btn-group" role="group">
		<a asp-controller="Product" asp-action="List" asp-route-category="" class="btn btn-secondary">Tất cả</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Bóng đá" class="btn btn-secondary">Bóng đá</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Tennis" class="btn btn-secondary">Tennis</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Quần áo" class="btn btn-secondary">Quần áo</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Giày dép" class="btn btn-secondary">Giày dép</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Bóng chuyền" class="btn btn-secondary">Bóng chuyền</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Cầu lông" class="btn btn-secondary">Cầu lông</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="dep" class="btn btn-secondary">Dép</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Cap" class="btn btn-secondary">Cặp</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="bata" class="btn btn-secondary">bata</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="non" class="btn btn-secondary">nón</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="Bóng rổ" class="btn btn-secondary">Bóng rổ</a>
		<a asp-controller="Product" asp-action="List" asp-route-category="quan ao" class="btn btn-secondary">Quần áo</a>
	</div>
</div>